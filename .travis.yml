language: node_js
node_js:
  - 10.15.2

branches:
  only:
  - master

script:
  - npm install -g snyk
  - snyk --version
  - snyk auth $SNYK_TOKEN
  - npm install
  - npm test
  - snyk monitor --project-name=simpleattendance-api

deploy:
  provider: heroku
  api_key: 
    secure: "$HEROKU_API_KEY"
  app: simpleattendance-api
  on: 
    repo: laudb/simple-attendance

services:
  - mongodb

after_success:
  - snyk monitor